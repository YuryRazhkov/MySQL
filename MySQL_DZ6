/*Задание по теме №6
/* 2. Пусть задан некоторый пользователь.
Из всех друзей этого пользователя найдите человека, который больше всех
общался с нашим пользователем.*/

-- считает верно. перепроверил руками.

select count(*), from_user_id from (
  (SELECT from_user_id FROM messages where to_user_id = 1071
  UNION ALL
  SELECT to_user_id FROM messages where from_user_id = 1071) as b,

  (select initiator_user_id from friend_requests where target_user_id = 1071
  UNION ALL
  select target_user_id from friend_requests where initiator_user_id = 1071) as a)
where from_user_id = initiator_user_id
group by from_user_id
order by 1 desc
limit 1;



-- 3. Подсчитать общее количество лайков, которые получили 10 самых
-- молодых пользователей.

Select SUM(total) from(
    SELECT COUNT( likes.user_id ) as total
		FROM vk.profiles profiles, vk.likes likes
		WHERE profiles.user_id = likes.user_id
		GROUP BY profiles.birthday
		ORDER BY profiles.birthday
		DESC LIMIT 10) as likes_list

-- --> 13 лайков
-- для проверки
-- SELECT COUNT( likes.user_id )
-- FROM vk.profiles profiles, vk.likes likes
-- WHERE profiles.user_id = likes.user_id
-- GROUP BY profiles.birthday
-- ORDER BY profiles.birthday
-- DESC LIMIT 10;

-- >2
-- 2
-- 2
-- 1
-- 1
-- 1
-- 1
-- 1
-- 1
-- 1

-- 4.Определить кто больше поставил лайков (всего) - мужчины или женщины?

    select MAX(s), MAX(g) from (
    SELECT COUNT(gender) as s, gender as g
	FROM vk.profiles profiles, vk.likes likes
	WHERE profiles.user_id = likes.user_id
	GROUP BY profiles.gender) as a
-- вывод:
-- >237	m
-- для проверки:
-- 232	f
-- 237	m
